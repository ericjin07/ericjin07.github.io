<!doctype html>
<html lang="en-us">

<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.55.6" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ARTS-WEEK 5 | Eric Jin</title>
    <meta property="og:title" content="ARTS-WEEK 5 - Eric Jin">
    <meta property="og:type" content="article">
    
    <meta property="article:published_time" content="2018-09-08T00:00:00&#43;08:00">
    
    
    <meta property="article:modified_time" content="2018-09-08T00:00:00&#43;08:00">
    
    <meta name="Keywords" content="golang,go语言,go语言笔记,Eric Jin,java,博客,项目管理,python,软件架构,">
    <meta name="description" content="ARTS-WEEK 5">
    <meta name="author" content="Eric Jin">
    
    <meta property="og:url" content="http://ericjin.com/arts/arts-week5/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/beantech.min.css">
    <link rel="stylesheet" href="/css/reward.css">
    <link rel="stylesheet" href="/css/prism.css">

    <link rel="stylesheet" href="/css/toc.css">
    <link rel="stylesheet" href="/css/widget.css">
    <link rel="stylesheet" href="/css/rocket.css">
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    


    
    
</head>

<body>
    



    


<style type="text/css">
    header.intro-header {
        background-image: url('http://ericjin.com/img/post-bg-hacker.jpg')
    }
</style>
<header class="intro-header">
    
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
                    <div class="post-heading">
                        
                        <div class="tags">
                            
                            <a href="http://ericjin.com/tags/arts">ARTS</a>
                            
                        </div>
                        
                        <h1>ARTS-WEEK 5</h1>
                        
                        <h2 class="subheading">something about kafka</h2>
                        
                        <span class="meta">
                            Posted by Eric Jin on
                            2018-09-09
                        </span>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</header>

    
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://ericjin.com/">Eric Jin</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="http://ericjin.com/">Home</a>
                    </li>

                    
                    <li>
                        <a href="http://ericjin.com/archives/" title="ARCHIVES">ARCHIVES</a>
                    </li>
                    
                    <li>
                        <a href="http://ericjin.com/tags/" title="TAGS">TAGS</a>
                    </li>
                    
                    <li>
                        <a href="http://ericjin.com/categories/" title="CATEGORIES">CATEGORIES</a>
                    </li>
                    
                    <li>
                        <a href="http://ericjin.com/about/" title="ABOUT">ABOUT</a>
                    </li>
                    

                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e) {
        if ($navbar.className.indexOf('in') > 0) {
            
            $navbar.className = " ";
            
            setTimeout(function () {
                
                if ($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            }, 400)
        } else {
            
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

    
    

<article>
    <div class="container">
        <div class="row">

            
            <div class="
                    col-lg-8 col-lg-offset-2
                    col-md-10 col-md-offset-1
                    post-container">
                

<blockquote>
<p>最近算法题倒是一天有写一道，不过总是无法抓住很好的review 和tip 来写,所以感觉写ARTS的时间总是耽搁又耽搁，比一起的间隔时间也长了好几天。</p>
</blockquote>

<h2 id="algorithm">Algorithm</h2>

<p>LeetCode <a href="https://leetcode.com/problems/count-and-say/description/">Count and Say</a>,简单。
这题算是比较印象深刻的一题，最开始这一题的题目都没有看清楚，不知道这是什么意思。后面才明白，是后一个数去say 前一个数，得到后一个数之后继续。这样其实就可以算是一种递归了。因为我们知道了递归因子，和边界点。</p>

<h5 id="description">Description</h5>

<p>The count-and-say sequence is the sequence of integers with the first five terms as following:</p>

<pre><code>1.     1
2.     11
3.     21
4.     1211
5.     111221
</code></pre>

<p><code>1</code> is read off as <code>&quot;one 1&quot;</code> or <code>11</code>.
<code>11</code> is read off as <code>&quot;two 1s&quot;</code> or <code>21</code>.
<code>21</code> is read off as <code>&quot;one 2</code>, then <code>one 1&quot;</code> or <code>1211</code>.</p>

<p>Given an integer n, generate the nth term of the count-and-say sequence.</p>

<p>Note: Each term of the sequence of integers will be represented as a string.
<strong>Example 1:</strong></p>

<pre><code>Input: 1
Output: &quot;1&quot;
</code></pre>

<p><strong>Example 2:</strong></p>

<pre><code>Input: 4
Output: &quot;1211&quot;
</code></pre>

<p><strong>Input Constraints:</strong></p>

<p>1 &lt;= n &lt;= 30</p>

<h5 id="solution">solution</h5>

<p>我们知道，要计算$n$个数，就需要计算第$n-1$个数，最后从第1个数开始推导。</p>

<pre><code class="language-java">public String countAndSay(int n) {
       if (n == 1) return &quot;1&quot;;
       String s = countAndSay(n-1);
       //用来存这个可变字串
       StringBuilder sb = new StringBuilder();
       char say = s.charAt(0);
       int cnt = 1;
       for (int i = 1; i &lt; s.length(); i++){
           char c = s.charAt(i);
           if (c == say){
               //如果前一个数和当前要读的一样，计数加一
               cnt ++;
           }else {
               //否则，字串就连接次数和前一个数
                sb.append(cnt).append(say);
                say = c;
                cnt = 1;
           }
       }
       //最后一个数就会跳出，所以得加上最后循环的say 和cnt
       sb.append(cnt).append(say);
       return sb.toString();
    }
</code></pre>

<h4 id="test">test</h4>

<pre><code class="language-java">    @Test
    public void countAndSay() {
        CountAndSay solution = new CountAndSay();
        assertEquals(&quot;1&quot;,solution.countAndSay(1));
        assertEquals(&quot;1211&quot;,solution.countAndSay(4));
    }
</code></pre>

<h2 id="review">Review</h2>

<p>刚好本周学习了一些Kafka方面的知识，顺便看到这篇文章，所以这周就用这篇文章来作为Review好了。
<a href="https://hackernoon.com/thorough-introduction-to-apache-kafka-6fbf2989bbc1">Thorough Introduction to Apache Kafka™</a>
这篇文章彻底深入的分析了Kafka是什么，它的好处，和它各个基础部分（producer,broker,consumer,topic,stream processor）。
我们先来看看它总结出来的一句对Kafka的描述：
&gt; stripped down to its core, Kafka is a distributed, horizontally-scalable, fault-tolerant, commit log.</p>

<p>先介绍了它的这几个特点：distributed（分布式）、horizontally-scalable（水平可扩展性）、fault-tolerant（容错性）、commit log（提交日志）。</p>

<h4 id="distributed">distributed</h4>

<p>可以让Kafka在多台机器上部署集群，提供一个结节（Leader）给用户去使用。这其实也保障了他的后面一个特性，fault-tolerant。关于分布式，作者引用了它自己的另一篇专门写分布式的<a href="https://hackernoon.com/a-thorough-introduction-to-distributed-systems-3b91562c9b3c">文章</a>,我也把这篇文章放在我的分享部分。</p>

<h4 id="horizontally-scalable">horizontally-scalable</h4>

<p>有水平的扩展性，自然相对就是垂直的扩展性。而垂直的扩展性就是硬件方面的，提高CPU，RAM，SSD等方面的资源。
但是这确确实实是有限的，局限于现有的科技、物理水平，垂直的扩展是有限制的。而且这种扩展是需要时间的，它可能需要你把当前的服务暂停然后去扩容，去更换更好的CPU等等，这对大公司是无法忍受的。</p>

<p>而水平的扩展，添加一台新的机器，把新机器加入你的集群之中。这就方便很多了。但是又不是所有的系统，项目都是支持这种水平扩容的，这就是Kafka的特性了。<br />
读到这里感觉，这其实都可以说是分布式的优势了。</p>

<h4 id="commit-log">commit log</h4>

<p>Kafka中的数据都是有顺序的，有序号记录的，它把数据记录在硬盘上，如果有序号的话，它的读写都是$O(1)$,读写也互相不影响，无论多少的数据，都是一样的。这就导致了在如今大量的数据流的互联网环境，Kafka的读写是多么的有利。</p>

<p>之后介绍了Kafka如何工作。比较重要的几点就是，
1. consumer在消费的时候，有一个offset，可以记录你上次的读取记录，你可以自己决定从哪开始读取。
2. kafka中的数据会复制保持在各个broker之中，保证如果一个Leader挂掉，其他的broker 可以马上选举，而且数据不会丢失。
3. kafka的元数据（Leader,partition&hellip;）都是记录在zookeeper中的，zookeeper的读比写快更多（注：zookeeper不是很熟，争取下周熟悉一下zookeeper的核心思想和设计理念）</p>

<p>然后：它的Stream Processing 不是很清楚。这一块的业务没有接触到真实的实例，需要做做实验才能更加深入！</p>

<h2 id="tip">Tip</h2>

<p>这周自己看了kafka的前面文档，自己在win 10 的Linux子系统里面安装了kafka.
1. 首先去官网下载<a href="https://www.apache.org/dyn/closer.cgi?path=/kafka/2.0.0/kafka_2.11-2.0.0.tgz">kafka</a>,解压。</p>

<pre><code>&gt; tar -xzf kafka_2.11-2.0.0.tgz
&gt; cd kafka_2.11-2.0.0
</code></pre>

<ol>
<li><p>开启服务。kafka首先需要zookeeper，所以如果有zookeeper的要先开启zookeeper；不然也可以用kafka内置的，去开启zookeeper的服务。</p>

<pre><code>&gt; bin/zookeeper-server-start.sh config/zookeeper.properties
</code></pre>

<p>或者直接在后台启动，不让它输出到终端。</p>

<pre><code>&gt; bin/zookeeper-server-start.sh config/zookeeper.properties 1&gt;/dev/null 2&gt;&amp;1 &amp;
</code></pre>

<p>然后开启Kafka服务：</p>

<pre><code>&gt; bin/kafka-server-start.sh config/server.properties
</code></pre></li>

<li><p>创建一个topic,之后你就可以让生产者往这个topic里面放数据，消费者从这个topic 里面拿数据了。</p>

<pre><code>&gt; bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test
</code></pre>

<p>这里只创建了一个分区和一份复制。</p></li>

<li><p>现在用生产者往这个<code>test</code>的topic里面放一些数据。</p>

<pre><code>&gt; bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
This is a message
This is another message
</code></pre></li>

<li><p>用消费者拿一些数据出来看看。</p>

<pre><code>&gt; bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning
This is a message
This is another message
</code></pre></li>

<li><p>目前都只是在一个kafka服务上面，kafka是可以做集群的。先来建立三个节点。</p>

<pre><code>&gt; cp config/server.properties config/server-1.properties
&gt; cp config/server.properties config/server-2.properties
</code></pre>

<p>负责两份配置文件，然后修改一下下面的关键参数即可：</p></li>
</ol>

<pre><code class="language-bash">config/server-1.properties:
    broker.id=1
    listeners=PLAINTEXT://:9093
    log.dirs=/tmp/kafka-logs-1
 
config/server-2.properties:
    broker.id=2
    listeners=PLAINTEXT://:9094
    log.dirs=/tmp/kafka-logs-2
</code></pre>

<p><code>broker.id</code>是每个节点中独一无二的属性，端口和日志文件地址也是因为目前是建立在一台机器上，所以需要有所区分。<br />
然后像之前那样启动这两个服务即可。</p>

<pre><code>&gt; bin/kafka-server-start.sh config/server-1.properties &amp;
...
&gt; bin/kafka-server-start.sh config/server-2.properties &amp;
</code></pre>

<p>再创建一个拥有三份复制的topic</p>

<pre><code>&gt; bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 3 --partitions 1 --topic my-replicated-topic
</code></pre>

<p>然后让我们来观察一下这个topic的状态：</p>

<pre><code>&gt; bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic my-replicated-topic
Topic:my-replicated-topic   PartitionCount:1    ReplicationFactor:3 Configs:
    Topic: my-replicated-topic  Partition: 0    Leader: 1   Replicas: 1,2,0 Isr: 1,2,0
</code></pre>

<p><code>Leader</code>，是负责所给分区的读与写。每个节点都有机会成为<code>leader</code>，这是随机选择出来的。
<code>Replicas</code>，是复制分区日志、数据的一列节点，因为建立的<code>broker.id</code>分别是0，1，2，所以这刚好也是这三个。
<code>Isr</code>，是&rsquo;In-Sync&rsquo;，是目前活着的一些节点。</p>

<p>到目前为止，这大概就是一个简单的kafka的上手了。可以快速体验一下kafka 不同于过去传统消息系统的区别。通过主题和订阅的方式让消费者都能得到数据，同时又运用队列和topic，让不同的消费者可以读到各自不同的数据。<br />
kafka才接触几天，浅薄之见，如有错误，请指出。
后续会继续读读Kafka官方的document，里面的design似乎讲的是它的设计，这个应该是它的精髓之所在。</p>

<h2 id="share">Share</h2>

<p>分享一篇关于分布式的文章：<br />
<a href="https://hackernoon.com/a-thorough-introduction-to-distributed-systems-3b91562c9b3c">A Thorough Introduction to Distributed Systems</a><br />
还有一篇blog,更上周是一个博主写的:<br />
<a href="https://programmingisterrible.com/post/173883533613/code-to-debug">Write code that’s easy to delete, and easy to debug too</a></p>

                <hr>
                
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="http://ericjin.com/arts/arts-week4/" data-toggle="tooltip" data-placement="top"
                            title="ARTS-WEEK 4">&larr; ARTS-WEEK 4</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="http://ericjin.com/tij%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" data-toggle="tooltip" data-placement="top"
                            title="异常丢失">异常丢失 &rarr;</a>
                    </li>
                    
                </ul>

                






<div class="post bg-white">
  <script src="https://utteranc.es/client.js" repo="ericjin07.github.io"
    issue-term="pathname" theme="github-light" crossorigin="anonymous"
    async>
    </script>
</div>



            </div>

            
            

<aside id="sidebar">
    <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#algorithm">Algorithm</a>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#solution">solution</a></li>
</ul></li>
<li><a href="#test">test</a></li>
</ul></li>
</ul></li>
<li><a href="#review">Review</a>
<ul>
<li>
<ul>
<li><a href="#distributed">distributed</a></li>
<li><a href="#horizontally-scalable">horizontally-scalable</a></li>
<li><a href="#commit-log">commit log</a></li>
</ul></li>
</ul></li>
<li><a href="#tip">Tip</a></li>
<li><a href="#share">Share</a></li>
</ul></li>
</ul>
</nav>
    </div>
</aside>


        </div>
    </div>
</article>

    

    
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
            
            <li>
                <a target="_blank" href="https://twitter.com/ericjin07">
                    <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                    </span>
                </a>
            </li>
            
            
            <li>
                <a target="_blank" href="https://www.zhihu.com/people/jin-zhi-bin">
                    <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa  fa-stack-1x fa-inverse">知</i>
                    </span>
                </a>
            </li>
            
            
            
            
            <li>
                <a target="_blank" href="https://github.com/ericjin07">
                    <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                    </span>
                </a>
            </li>
            
            
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Eric Jin 2018
                    <br>
                    Theme by <a href="http://huangxuan.me" target="blank">Hux</a>
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>

                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px"
                        height="20px" src="https://ghbtns.com/github-btn.html?user=ericjin07&amp;repo=hexo-blog-sources&amp;type=star&amp;count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>


<script type="text/javascript">
    
    (function () {
        $("pre code").parent().addClass("line-numbers")
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [['$', '$']],
            processEscapes: true
        }
    };
</script>
<script type="text/javascript" src="/js/prism.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js" async></script>
<script type="text/javascript" src="/js/toc.js" async></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/jquery.nav.js"></script>
<script type="text/javascript" src="/js/jquery.tagcloud.js"></script>
<script type="text/javascript" src="/js/hux-blog.min.js" async></script>



<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>






<script>
    
    if ($('#tag_cloud').length !== 0) {
        function load_tag() {
            $.fn.tagcloud.defaults = {
                
                color: { start: '#bbbbee', end: '#0085a1' },
            };
            $('#tag_cloud a').tagcloud();
        }
        load_tag()
    }

</script>

</body>

</html>